<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flaneur</title>
</head>
<body>
    Hello, web deberopuru.hello

    <button id="foo">Foo</button>
    <button id="fooWith">FooWith</button>

    <script type="text/javascript">
        document.querySelector("#foo").addEventListener("click", () => invoke("foo"));
        document.querySelector("#fooWith").addEventListener("click", () => invoke("fooWith?bar=1&t=2"));
        const abortController = new AbortController();

        function invoke(endPoint) {
            const options = {
                keepalive: true,
                signal: abortController.signal,
                method: "GET"
            };
            fetch(`flaneur://app/${endPoint}`, options)
                .then((response) => response.body.pipeThrough(new TextDecoderStream()).getReader())
                .then(async (reader) => {
                    console.log("Started");
                    while (true) {
                        const { value, done } = await reader.read();
                        if (done) {
                            console.log("Completed");
                            break;
                        }
                        console.log("Received", value);
                    }
                    reader.releaseLock();
                })
                .catch(console.error);
        }
        
    </script>
</body>
</html>