<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flaneur</title>
</head>
<body>
    Hello, web deberopuru.

    <button id="foo">Foo</button>
    <button id="fooWith">FooWith</button>

    <script type="text/javascript">
        // setup AbortController
        const controller = new AbortController();
        // signal to pass to fetch
        const signal = controller.signal;
        document.querySelector("#foo").addEventListener("click", () => invoke("foo"))
        document.querySelector("#fooWith").addEventListener("click", () => invoke("fooWith?bar=1&t=2"))
        function invoke(endPoint) {
            fetch(`flaneur://localhost/${endPoint}`, { signal })
                .then((response) => response.body.pipeThrough(new TextDecoderStream()).getReader())
                .then(async (reader) => {
                    console.log("Started");
                    while (true) {
                        const { value, done } = await reader.read();
                        if (done) {
                            console.log("Completed");
                            break;
                        }
                        console.log("Received", value);
                    }
                    reader.releaseLock();
                })
                .catch(console.error);

            setTimeout(() => controller.abort(), 5000);
        }
        
    </script>
</body>
</html>